<div class="calc-page">
  <div class="calc-page__header">
    <h1>Schedule E Subject Property Calculator</h1>
    <p>Analyze rental income from Schedule E for the subject property using Fannie Mae guidelines. No monthly payment is subtracted for subject property analysis.</p>
  </div>

  <div class="calc-page__body">

    <!-- Upload Zone -->
    <div class="calc-section">
      <h2>Upload Schedule E</h2>
      <p class="text-muted text-sm" style="margin-bottom: var(--space-sm);">Upload Schedule E pages to auto-fill fields. Upload one per tax year (max 2).</p>

      <div class="upload-zone" data-upload-type="income-schedule-e-subject">
        <div class="upload-zone__icon">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="upload-zone__text">
          <strong>Upload Schedule E</strong>
          <span>Drop or click to upload a Schedule E image or PDF</span>
        </div>
        <input type="file" class="upload-zone__input" accept="image/*,application/pdf" style="display: none;">
        <div class="upload-zone__status"></div>
      </div>

      <!-- JS-rendered document cards -->
      <div id="docCards"></div>
    </div>

    <!-- Policy Explanation -->
    <div class="calc-section">
      <div class="policy-box">
        <h5>Subject Property Income Policy</h5>
        <p>
          Only add lines 9 and 16 (insurance and taxes) if needed to qualify. If added back, obtain
          documentation to verify the payment includes PITI. Subject property analysis does NOT
          subtract a monthly payment.
        </p>
      </div>
    </div>

    <!-- Subject Property Income Table -->
    <div class="calc-section">
      <h2>Subject Property Line Items</h2>
      <p class="text-muted text-sm" style="margin-bottom: var(--space-sm);">Enter Schedule E line items for the subject property. Positive values are added; total expenses are subtracted.</p>

      <table class="income-table">
        <thead>
          <tr>
            <th>Description</th>
            <th>Line #</th>
            <th>Sign</th>
            <th>Year 1 (Most Recent)</th>
            <th>Year 2 (Prior)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Rents Received</td>
            <td class="line-number">3</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_rents" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_rents" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Royalties Received</td>
            <td class="line-number">4</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_roy" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_roy" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Amortization/Casualty Loss</td>
            <td class="line-number">19</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_cas" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_cas" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Total Expenses (SUBTRACT)</td>
            <td class="line-number">20</td>
            <td class="sign-col subtract">&minus;</td>
            <td><input type="number" id="sr1_exp" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_exp" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Depreciation</td>
            <td class="line-number">18</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_dep" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_dep" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Insurance</td>
            <td class="line-number">9</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_ins" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_ins" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Mortgage Interest</td>
            <td class="line-number">12</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_int" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_int" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Taxes</td>
            <td class="line-number">16</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="sr1_tax" value="0" oninput="calculate()"></td>
            <td><input type="number" id="sr2_tax" value="0" oninput="calculate()"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Results -->
    <div class="calc-section">
      <h2>Results</h2>

      <div class="results-grid">
        <div class="result-card">
          <div class="result-card__label">Year 1 Total</div>
          <div class="result-card__value" id="sr_total1">$0.00</div>
        </div>
        <div class="result-card">
          <div class="result-card__label">Year 2 Total</div>
          <div class="result-card__value" id="sr_total2">$0.00</div>
        </div>
      </div>

      <div class="result-highlight" style="margin-top: var(--space-lg);">
        <div class="result-highlight__label">Monthly Average</div>
        <div class="result-highlight__value" id="sr_avg">$0.00</div>
      </div>

      <div class="action-bar">
        <button type="button" class="btn btn-secondary" onclick="exportCSV()">Export CSV</button>
        <button type="button" class="btn btn-secondary" onclick="window.print()">Print</button>
        <button type="button" class="btn btn-ghost" onclick="clearAll()">Clear All</button>
      </div>
    </div>

    <%- include('../../partials/show-calculations', { calcId: 'income-schedule-e-subject' }) %>

  </div>

  <div class="calc-page__footer">
    <div class="calc-page__footer-title">Subject Property Guidelines</div>
    <p>
      For subject property rental income analysis, Schedule E line items are totaled without
      subtracting a monthly mortgage payment. Insurance (Line 9) and taxes (Line 16) should
      only be added back if needed to qualify, and documentation must verify the payment
      includes PITI. This differs from non-subject rental properties where the monthly
      PITIA payment is subtracted from the net rental income.
    </p>
  </div>
</div>
