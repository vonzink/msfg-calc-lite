<div class="calc-page">
  <div class="calc-page__header">
    <h1>Form 1120 Corporation Income Calculator</h1>
    <p>Calculate monthly income from C-Corporation (Form 1120) returns with ownership percentages and comprehensive add-backs.</p>
  </div>

  <div class="calc-page__body">

    <!-- Upload Zone -->
    <div class="calc-section">
      <h2>Upload Form 1120</h2>
      <p class="text-muted text-sm" style="margin-bottom: var(--space-sm);">Upload IRS Form 1120 pages to auto-fill fields. Upload one per tax year (max 2). Include Schedule L, M-1, and B pages if available.</p>

      <div class="upload-zone" data-upload-type="income-1120">
        <div class="upload-zone__icon">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="upload-zone__text">
          <strong>Upload Form 1120</strong>
          <span>Drop or click to upload a 1120 image or PDF</span>
        </div>
        <input type="file" class="upload-zone__input" accept="image/*,application/pdf" style="display: none;">
        <div class="upload-zone__status"></div>
      </div>

      <!-- JS-rendered document cards -->
      <div id="docCards"></div>
    </div>

    <!-- Policy Explanation -->
    <div class="calc-section">
      <div class="policy-box">
        <h5>C-Corporation Income Policy</h5>
        <p>
          Sum income items, add back non-cash expenses, subtract taxes and short-term debt,
          multiply by ownership %, then subtract dividends received. For conforming loans,
          100% ownership is typically required.
        </p>
      </div>

      <!-- Ownership warning â€” shown/hidden by JS -->
      <div class="warning-box" id="ownershipWarning" style="display: none;">
        <p><strong>Note:</strong> For conforming loans, C-Corporation income typically requires 100% ownership to be used for qualification.</p>
      </div>
    </div>

    <!-- Form 1120 Income Items -->
    <div class="calc-section">
      <h2>Form 1120 Income Items</h2>
      <p class="text-muted text-sm" style="margin-bottom: var(--space-sm);">Enter line items from the corporation's Form 1120 tax return.</p>

      <table class="income-table">
        <thead>
          <tr>
            <th>Description</th>
            <th>Line #</th>
            <th>Sign</th>
            <th>Year 1 (Most Recent)</th>
            <th>Year 2 (Prior)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Capital Gain Net Income/Loss</td>
            <td class="line-number">8</td>
            <td class="sign-col add">+/&minus;</td>
            <td><input type="number" id="cap1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="cap2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Net Gain or Loss</td>
            <td class="line-number">9</td>
            <td class="sign-col add">+/&minus;</td>
            <td><input type="number" id="net1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="net2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Other Income or Loss</td>
            <td class="line-number">10</td>
            <td class="sign-col add">+/&minus;</td>
            <td><input type="number" id="oth1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="oth2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Depreciation</td>
            <td class="line-number">20</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="dep1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="dep2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Depletion</td>
            <td class="line-number">21</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="depl1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="depl2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Domestic Production Activities Deduction</td>
            <td class="line-number">25</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="dpd1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="dpd2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Amortization/Casualty Loss</td>
            <td class="line-number">26</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="amort1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="amort2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Net Operating Loss &amp; Special Deductions</td>
            <td class="line-number">29</td>
            <td class="sign-col add">+</td>
            <td><input type="number" id="nol1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="nol2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Taxable Income</td>
            <td class="line-number">30</td>
            <td class="sign-col add">+/&minus;</td>
            <td><input type="number" id="taxable1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="taxable2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Total Tax</td>
            <td class="line-number">31</td>
            <td class="sign-col subtract">&minus;</td>
            <td><input type="number" id="totaltax1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="totaltax2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Mortgages/Notes Payable &lt; 1 Year</td>
            <td class="line-number">Sch L ln 17</td>
            <td class="sign-col subtract">&minus;</td>
            <td><input type="number" id="mort1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="mort2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Meals &amp; Entertainment Exclusion</td>
            <td class="line-number">Sch M-1 5c</td>
            <td class="sign-col subtract">&minus;</td>
            <td><input type="number" id="meals1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="meals2" value="0" oninput="calculate()"></td>
          </tr>
          <tr>
            <td>Dividends Paid to Borrower</td>
            <td class="line-number">Sch B ln 5</td>
            <td class="sign-col subtract">&minus;</td>
            <td><input type="number" id="dividend1" value="0" oninput="calculate()"></td>
            <td><input type="number" id="dividend2" value="0" oninput="calculate()"></td>
          </tr>
        </tbody>
      </table>

      <div class="ownership-row">
        <label for="ownership">Ownership Percentage:</label>
        <input type="number" id="ownership" value="100" min="0" max="100" step="0.01" oninput="calculate()">
        <span>%</span>
        <div class="ownership-note">For conforming loans, C-Corp income typically requires 100% ownership.</div>
      </div>

      <div class="corp-results">
        <div class="corp-result-item">
          <div class="label">Year 1 Income</div>
          <div class="value" id="yr1_total">$0.00</div>
        </div>
        <div class="corp-result-item">
          <div class="label">Year 2 Income</div>
          <div class="value" id="yr2_total">$0.00</div>
        </div>
        <div class="corp-result-item">
          <div class="label">Monthly Income</div>
          <div class="value" id="monthly_income">$0.00</div>
        </div>
      </div>
    </div>

    <!-- Combined Results -->
    <div class="calc-section">
      <h2>Result</h2>

      <div class="result-highlight">
        <div class="result-highlight__label">Total Monthly Income</div>
        <div class="result-highlight__value" id="combined1120">$0.00</div>
      </div>

      <div class="action-bar">
        <button type="button" class="btn btn-secondary" onclick="exportCSV()">Export CSV</button>
        <button type="button" class="btn btn-secondary" onclick="window.print()">Print</button>
        <button type="button" class="btn btn-ghost" onclick="clearAll()">Clear All</button>
      </div>
    </div>

    <%- include('../../partials/show-calculations', { calcId: 'income-1120' }) %>

  </div>

  <div class="calc-page__footer">
    <div class="calc-page__footer-title">Form 1120 Guidelines</div>
    <p>
      C-Corporation income analysis includes taxable income plus non-cash add-backs
      (depreciation, depletion, amortization, NOL). Corporate taxes and short-term obligations
      are subtracted. Dividends paid to the borrower are deducted after applying ownership
      percentage since they are reported as personal income.
    </p>
  </div>
</div>
