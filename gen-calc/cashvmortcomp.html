<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cash vs Mortgage Calculator</title>
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    <div class="main-container">
      <div class="header">
        <img src="/images/msfg-logo.png" 
             alt="MSFG Home Loans" 
             class="header-logo" />
        <h1>Cash vs Mortgage Calculator</h1>
        <p>
          Compare the net cost of paying cash versus taking a mortgage over a specified period. 
          This calculator factors in property appreciation, investment returns on unused cash, 
          and the remaining mortgage balance at the end of the analysis period.
        </p>
      </div>
      
      <div class="content">
        
        <!-- Purchase Information -->
        <div class="section">
          <h2>Purchase Information</h2>
          <div class="input-grid">
            <div class="input-group">
              <label for="priceCash">Purchase Price ($)</label>
              <input type="number" id="priceCash" value="400000" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="closingCash">Closing Costs - Cash Purchase ($)</label>
              <input type="number" id="closingCash" value="2000" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="closingMortgage">Closing Costs - Mortgage ($)</label>
              <input type="number" id="closingMortgage" value="8000" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
          </div>
        </div>

        <!-- Mortgage Details -->
        <div class="section">
          <h2>Mortgage Details</h2>
          <div class="input-grid">
            <div class="input-group">
              <label for="downPct">Down Payment (%)</label>
              <input type="number" id="downPct" value="20" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="mortRate">Interest Rate (%)</label>
              <input type="number" id="mortRate" step="0.125" value="6.5" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="mortTerm">Loan Term (years)</label>
              <input type="number" id="mortTerm" value="30" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
          </div>
        </div>

        <!-- Investment & Analysis Period -->
        <div class="section">
          <h2>Investment & Analysis Period</h2>
          <div class="input-grid">
            <div class="input-group">
              <label for="investReturn">Expected Annual Investment Return (%)</label>
              <input type="number" id="investReturn" step="0.5" value="7" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="appreciation">Annual Property Appreciation (%)</label>
              <input type="number" id="appreciation" step="0.5" value="3" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
            <div class="input-group">
              <label for="periodCash">Analysis Period (years)</label>
              <input type="number" id="periodCash" value="10" onchange="calcCashMortgage()" class="input-highlight" />
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
          <h2>Total Cost Comparison</h2>
          <div class="results-grid">
            <div class="result-card">
              <h3>Cash Purchase Cost</h3>
              <div class="result-value" id="costCash">$0</div>
            </div>
            <div class="result-card">
              <h3>Mortgage Cost</h3>
              <div class="result-value" id="costMortgage">$0</div>
            </div>
          </div>

          <div id="differenceCard" class="difference">
            <h3 id="differenceText">Cost Difference</h3>
            <div class="difference-value" id="diffCashMort">$0</div>
          </div>
        </div>

        <!-- Cost Breakdown -->
        <div class="breakdown-section">
          <div class="breakdown-card">
            <h3>Cash Purchase Breakdown</h3>
            <div class="breakdown-item">
              <span class="breakdown-label">Purchase Price</span>
              <span class="breakdown-value" id="cashPurchasePrice">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Closing Costs</span>
              <span class="breakdown-value" id="cashClosingCosts">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Property Appreciation</span>
              <span class="breakdown-value" id="cashAppreciation">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Net Cost</span>
              <span class="breakdown-value" id="cashTotal">$0</span>
            </div>
          </div>

          <div class="breakdown-card">
            <h3>Mortgage Purchase Breakdown</h3>
            <div class="breakdown-item">
              <span class="breakdown-label">Down Payment</span>
              <span class="breakdown-value" id="mortDownPayment">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Closing Costs</span>
              <span class="breakdown-value" id="mortClosingCosts">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Mortgage Payments</span>
              <span class="breakdown-value" id="mortPayments">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Investment Balance</span>
              <span class="breakdown-value" id="mortInvestmentBalance">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Remaining Mortgage Balance</span>
              <span class="breakdown-value" id="mortRemainingBalance">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Net Investment Benefit</span>
              <span class="breakdown-value" id="mortInvestmentGrowth">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Property Appreciation</span>
              <span class="breakdown-value" id="mortAppreciation">$0</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Net Cost</span>
              <span class="breakdown-value" id="mortTotal">$0</span>
            </div>
          </div>
        </div>

        <!-- Recommendation -->
        <div class="conclusion">
          <h3>Financial Recommendation</h3>
          <div class="recommendation" id="recommendation">
            <!-- Recommendation will be populated by JavaScript -->
          </div>
          <p id="conclusionText">
            <!-- Conclusion text will be populated by JavaScript -->
          </p>
        </div>

        <!-- Show the Math Section -->
        <div class="math-section">
          <h3>
            Detailed Calculations
            <button class="toggle-button" onclick="toggleCalculations()">
              <span id="toggleText">Show Details</span>
            </button>
          </h3>
          <div id="mathCalculations" class="hidden">
            <!-- Math calculations will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
    <script>
      function parseNum(v) {
        const n = parseFloat(v);
        return isNaN(n) ? 0 : n;
      }
      
      function mortgagePay(principal, rate, months) {
        if (rate === 0) return principal / months;
        const m = rate / 12;
        return (principal * m) / (1 - Math.pow(1 + m, -months));
      }
      
      function futureValue(amount, rate, years) {
        return amount * Math.pow(1 + rate, years);
      }
      
      function balanceAfterPayments(principal, rate, totalMonths, paymentsMade) {
        if (paymentsMade >= totalMonths) return 0;
        if (rate === 0) return principal - (principal / totalMonths) * paymentsMade;
        const m = rate / 12;
        const pmt = mortgagePay(principal, rate, totalMonths);
        return principal * Math.pow(1 + m, paymentsMade) -
               pmt * ((Math.pow(1 + m, paymentsMade) - 1) / m);
      }
      
      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(amount);
      }
      
      function toggleCalculations() {
        const calculations = document.getElementById('mathCalculations');
        const toggleText = document.getElementById('toggleText');
        
        if (calculations.classList.contains('hidden')) {
          calculations.classList.remove('hidden');
          toggleText.textContent = 'Hide Details';
        } else {
          calculations.classList.add('hidden');
          toggleText.textContent = 'Show Details';
        }
      }
      
      function calcCashMortgage() {
        // Get input values
        const price = parseNum(document.getElementById('priceCash').value);
        const closingCash = parseNum(document.getElementById('closingCash').value);
        const closingMort = parseNum(document.getElementById('closingMortgage').value);
        const downPct = parseNum(document.getElementById('downPct').value) / 100;
        const rate = parseNum(document.getElementById('mortRate').value) / 100;
        const term = parseNum(document.getElementById('mortTerm').value);
        const investR = parseNum(document.getElementById('investReturn').value) / 100;
        const apprR = parseNum(document.getElementById('appreciation').value) / 100;
        const period = parseNum(document.getElementById('periodCash').value);
        
        // Calculate derived values
        const down = price * downPct;
        const loan = price - down;
        const months = term * 12;
        const monthly = mortgagePay(loan, rate, months);
        const analysisMonths = period * 12;
        
        // Property appreciation (same for both scenarios)
        const appreciatedValue = price * Math.pow(1 + apprR, period);
        const appreciationGain = appreciatedValue - price;
        
        // Calculate cash purchase costs
        let costCash = price + closingCash - appreciationGain;
        
        // Calculate mortgage purchase costs
        let costMort = down + closingMort;
        let investBalance = price - down - closingMort;
        
        for (let m = 1; m <= analysisMonths; m++) {
          costMort += monthly;
          investBalance *= 1 + investR / 12;
        }
        
        // Calculate remaining mortgage balance at end of analysis period
        const remainingBalance = Math.max(0, balanceAfterPayments(loan, rate, months, Math.min(analysisMonths, months)));
        
        // Net investment benefit: investments minus remaining balance payoff
        const initialInvestment = price - down - closingMort;
        const netAfterPayoff = investBalance - remainingBalance;
        const investmentGrowth = netAfterPayoff - initialInvestment;
        costMort -= investmentGrowth;
        costMort -= appreciationGain;
        
        const diff = costMort - costCash;
        
        // Update main results
        document.getElementById('costCash').textContent = formatCurrency(costCash);
        document.getElementById('costMortgage').textContent = formatCurrency(costMort);
        document.getElementById('diffCashMort').textContent = formatCurrency(Math.abs(diff));
        
        // Update difference styling and text
        const diffCard = document.getElementById('differenceCard');
        const diffText = document.getElementById('differenceText');
        if (diff > 0) {
          diffCard.className = 'difference negative';
          diffText.textContent = 'Mortgage costs MORE than cash';
        } else {
          diffCard.className = 'difference positive';
          diffText.textContent = 'Mortgage costs LESS than cash';
        }
        
        // Update breakdowns
        updateBreakdowns(price, closingCash, closingMort, down, monthly, analysisMonths, 
                        costCash, costMort, investmentGrowth, investBalance, remainingBalance, appreciationGain);
        
        // Update math calculations
        updateMathCalculations(price, closingCash, closingMort, down, loan, rate, monthly, 
                              analysisMonths, investR, investmentGrowth, 
                              costCash, costMort, diff, investBalance, remainingBalance, 
                              apprR, appreciatedValue, appreciationGain);
        
        // Update recommendation
        updateRecommendation(diff, Math.abs(diff), costCash, costMort);
      }
      
      function updateBreakdowns(price, closingCash, closingMort, down, monthly, analysisMonths, 
                               costCash, costMort, investmentGrowth, investBalance, remainingBalance, appreciationGain) {
        // Cash breakdown
        document.getElementById('cashPurchasePrice').textContent = formatCurrency(price);
        document.getElementById('cashClosingCosts').textContent = formatCurrency(closingCash);
        document.getElementById('cashAppreciation').textContent = '-' + formatCurrency(appreciationGain);
        document.getElementById('cashTotal').textContent = formatCurrency(costCash);
        
        // Mortgage breakdown
        document.getElementById('mortDownPayment').textContent = formatCurrency(down);
        document.getElementById('mortClosingCosts').textContent = formatCurrency(closingMort);
        document.getElementById('mortPayments').textContent = formatCurrency(monthly * analysisMonths);
        document.getElementById('mortInvestmentBalance').textContent = formatCurrency(investBalance);
        document.getElementById('mortRemainingBalance').textContent = '-' + formatCurrency(remainingBalance);
        document.getElementById('mortInvestmentGrowth').textContent = '-' + formatCurrency(investmentGrowth);
        document.getElementById('mortAppreciation').textContent = '-' + formatCurrency(appreciationGain);
        document.getElementById('mortTotal').textContent = formatCurrency(costMort);
      }
      
      function updateMathCalculations(price, closingCash, closingMort, down, loan, rate, monthly, 
                                    analysisMonths, investR, investmentGrowth, 
                                    costCash, costMort, diff, investBalance, remainingBalance,
                                    apprR, appreciatedValue, appreciationGain) {
        const mathDiv = document.getElementById('mathCalculations');
        
        const mortgagePaymentsTotal = monthly * analysisMonths;
        const initialInvestment = price - down - closingMort;
        const termMonths = parseNum(document.getElementById('mortTerm').value) * 12;
        const period = analysisMonths / 12;
        
        mathDiv.innerHTML = `
          <div class="calculation-step">
            <h4>Property Appreciation</h4>
            <p>Appreciated Value = Purchase Price × (1 + ${(apprR * 100).toFixed(2)}%)^${period}</p>
            <p>Appreciated Value = ${formatCurrency(price)} × ${Math.pow(1 + apprR, period).toFixed(4)} = ${formatCurrency(appreciatedValue)}</p>
            <p>Appreciation Gain = ${formatCurrency(appreciatedValue)} - ${formatCurrency(price)} = ${formatCurrency(appreciationGain)}</p>
            <p>This gain applies equally to both the cash buyer and mortgage buyer.</p>
          </div>
          
          <div class="calculation-step">
            <h4>Cash Purchase Calculation</h4>
            <p>Net Cost = Purchase Price + Closing Costs - Appreciation Gain</p>
            <p>Net Cost = ${formatCurrency(price)} + ${formatCurrency(closingCash)} - ${formatCurrency(appreciationGain)}</p>
            <p>Net Cost = ${formatCurrency(costCash)}</p>
          </div>
          
          <div class="calculation-step">
            <h4>Mortgage Purchase Calculation</h4>
            <p>Monthly Payment = P × [r(1+r)^n] / [(1+r)^n - 1]</p>
            <p>Where P = ${formatCurrency(loan)}, r = ${(rate * 100).toFixed(2)}%/12, n = ${termMonths} months</p>
            <p>Monthly Payment = ${formatCurrency(monthly)}</p>
            <p>Total Mortgage Payments (${analysisMonths} months) = ${formatCurrency(monthly)} × ${analysisMonths} = ${formatCurrency(mortgagePaymentsTotal)}</p>
          </div>
          
          <div class="calculation-step">
            <h4>Investment Growth Calculation</h4>
            <p>Initial Investment = Purchase Price - Down Payment - Mortgage Closing Costs</p>
            <p>Initial Investment = ${formatCurrency(price)} - ${formatCurrency(down)} - ${formatCurrency(closingMort)} = ${formatCurrency(initialInvestment)}</p>
            <p>Monthly Growth Rate = ${(investR * 100).toFixed(2)}% / 12 = ${(investR / 12 * 100).toFixed(4)}%</p>
            <p>Investment Balance = ${formatCurrency(initialInvestment)} × (1 + ${(investR / 12).toFixed(6)})^${analysisMonths} = ${formatCurrency(investBalance)}</p>
          </div>
          
          <div class="calculation-step">
            <h4>Remaining Mortgage Balance</h4>
            <p>After ${analysisMonths} payments on a ${termMonths}-month loan:</p>
            <p>Remaining Balance = ${formatCurrency(remainingBalance)}</p>
            <p>At the end of the analysis period, the remaining mortgage balance must be paid off from the investment savings.</p>
          </div>
          
          <div class="calculation-step">
            <h4>Net Investment Benefit</h4>
            <p>Net After Payoff = Investment Balance - Remaining Mortgage Balance</p>
            <p>Net After Payoff = ${formatCurrency(investBalance)} - ${formatCurrency(remainingBalance)} = ${formatCurrency(investBalance - remainingBalance)}</p>
            <p>Net Investment Benefit = Net After Payoff - Initial Investment</p>
            <p>Net Investment Benefit = ${formatCurrency(investBalance - remainingBalance)} - ${formatCurrency(initialInvestment)} = ${formatCurrency(investmentGrowth)}</p>
          </div>
          
          <div class="calculation-step">
            <h4>Total Mortgage Cost</h4>
            <p>Net Cost = Down Payment + Closing Costs + Mortgage Payments - Net Investment Benefit - Appreciation Gain</p>
            <p>Net Cost = ${formatCurrency(down)} + ${formatCurrency(closingMort)} + ${formatCurrency(mortgagePaymentsTotal)} - ${formatCurrency(investmentGrowth)} - ${formatCurrency(appreciationGain)}</p>
            <p>Net Cost = ${formatCurrency(costMort)}</p>
          </div>
          
          <div class="calculation-step">
            <h4>Cost Difference</h4>
            <p>Difference = Mortgage Cost - Cash Cost</p>
            <p>Difference = ${formatCurrency(costMort)} - ${formatCurrency(costCash)} = ${formatCurrency(diff)}</p>
          </div>
        `;
      }
      
      function updateRecommendation(diff, absDiff, costCash, costMort) {
        const recommendation = document.getElementById('recommendation');
        const conclusionText = document.getElementById('conclusionText');
        
        const savingsPercent = ((absDiff / Math.min(costCash, costMort)) * 100).toFixed(1);
        
        if (diff > 0) {
          recommendation.textContent = `RECOMMENDATION: Pay Cash`;
          conclusionText.innerHTML = `
            <strong>Paying cash is the better financial choice.</strong><br>
            You would save <strong>${formatCurrency(absDiff)}</strong> (${savingsPercent}% of the lower cost option) 
            by paying cash instead of taking a mortgage. This analysis assumes you would invest the 
            remaining cash at the specified return rate if you chose the mortgage option.
          `;
        } else {
          recommendation.textContent = `RECOMMENDATION: Take Mortgage`;
          conclusionText.innerHTML = `
            <strong>Taking a mortgage is the better financial choice.</strong><br>
            You would save <strong>${formatCurrency(absDiff)}</strong> (${savingsPercent}% of the lower cost option) 
            by taking a mortgage instead of paying cash. This assumes you invest the remaining cash 
            at the specified return rate, which generates enough growth to offset the mortgage costs.
          `;
        }
      }
      
      // Initialize calculator
      calcCashMortgage();
    </script>
  </body>
</html>
