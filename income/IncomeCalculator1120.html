<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form 1120 Corporation Income Calculator - MSFG Home Loans</title>
    <link rel="stylesheet" href="/css/main.css" />
    <style>
      .income-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; background: var(--light); border-radius: 8px; overflow: hidden; }
      .income-table th { background: var(--primary); color: var(--light); padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; }
      .income-table td { padding: 0.75rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
      .income-table tr:last-child td { border-bottom: none; }
      .income-table tr:hover td { background: var(--light-gray); }
      .income-table input[type="number"] { width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font-size: 0.9rem; background: var(--light-gray); }
      .income-table input[type="number"]:focus { outline: none; border-color: var(--accent); background: var(--light); }
      .line-number { font-weight: 600; color: var(--primary); white-space: nowrap; font-size: 0.85rem; }
      .sign-col { text-align: center; font-weight: 700; width: 50px; }
      .sign-col.add { color: var(--success); }
      .sign-col.subtract { color: var(--danger); }
      .ownership-row { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; padding: 1rem; background: var(--light-gray); border-radius: 8px; flex-wrap: wrap; }
      .ownership-row label { font-weight: 600; color: var(--primary); }
      .ownership-row input { width: 100px; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem; text-align: center; }
      .ownership-note { font-size: 0.85rem; color: var(--gray); margin-top: 0.5rem; width: 100%; }
      .math-steps { display: flex; flex-direction: column; gap: 1rem; }
      .math-step { background: var(--light-gray); border-radius: 8px; padding: 1.25rem; border-left: 4px solid var(--accent); }
      .math-step.highlight { background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%); border-left-color: var(--primary); }
      .math-step h4 { color: var(--primary); margin: 0 0 0.75rem 0; font-size: 1rem; }
      .math-formula { font-family: 'Courier New', monospace; font-size: 0.9rem; color: var(--dark); line-height: 1.8; }
      .math-note { color: var(--gray); font-style: italic; font-family: 'Segoe UI', sans-serif; font-size: 0.85rem; }
      .math-values { display: block; margin-top: 0.5rem; padding: 0.75rem; background: var(--light); border-radius: 4px; color: var(--primary); font-weight: 600; }
      .policy-box { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
      .policy-box h5 { color: #856404; margin-bottom: 0.5rem; }
      .policy-box p { color: #856404; font-size: 0.9rem; margin: 0; }
      .warning-box { background: #f8d7da; border: 1px solid #dc3545; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
      .warning-box p { color: #721c24; font-size: 0.9rem; margin: 0; }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="header">
        <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/Compass/Compass+Home+Loan+-+Color+Transparent+Background.png" alt="Compass Home Loan" class="header-logo" />
        <h1>Form 1120 Corporation Income Calculator</h1>
        <p>Calculate monthly income from C-Corporation (Form 1120) returns with ownership percentages and comprehensive add-backs.</p>
      </div>
      
      <div class="content">
        
        <div class="policy-box">
          <h5>üìã C-Corporation Income Policy</h5>
          <p>Sum income items, add back non-cash expenses, subtract taxes and short-term debt, multiply by ownership %, then subtract dividends received. For conforming loans, 100% ownership is typically required.</p>
        </div>

        <div class="warning-box" id="ownershipWarning" style="display: none;">
          <p>‚ö†Ô∏è <strong>Note:</strong> For conforming loans, C-Corporation income typically requires 100% ownership to be used for qualification.</p>
        </div>

        <div class="section">
          <h2>Form 1120 Income Items</h2>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Line #</th>
                <th>Sign</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Capital Gain Net Income/Loss (non-recurring)</td>
                <td class="line-number">8</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="cap1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="cap2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Net Gain or Loss (non-recurring)</td>
                <td class="line-number">9</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="net1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="net2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Other Income or Loss (non-recurring)</td>
                <td class="line-number">10</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="oth1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="oth2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depreciation</td>
                <td class="line-number">20</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="dep1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="dep2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depletion</td>
                <td class="line-number">21</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="depl1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="depl2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Domestic Production Activities Deduction</td>
                <td class="line-number">25</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="dpd1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="dpd2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Amortization/Casualty Loss</td>
                <td class="line-number">26</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="amort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="amort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Net Operating Loss & Special Deductions</td>
                <td class="line-number">29</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="nol1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="nol2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Taxable Income (positive or negative)</td>
                <td class="line-number">30</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="taxable1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="taxable2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Total Tax</td>
                <td class="line-number">31</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="totaltax1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="totaltax2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Mortgages/Notes Payable &lt; 1 Year</td>
                <td class="line-number">Sch L ln 17</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="mort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="mort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Meals & Entertainment Exclusion</td>
                <td class="line-number">Sch M-1 5c</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="meals1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="meals2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Dividends Paid to Borrower</td>
                <td class="line-number">Sch B ln 5</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="dividend1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="dividend2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="ownership-row">
            <label for="ownership">Ownership Percentage:</label>
            <input type="number" id="ownership" value="100" min="0" max="100" step="0.01" oninput="calculate()" />
            <span>%</span>
            <div class="ownership-note">For conforming loans, C-Corp income typically requires 100% ownership.</div>
          </div>
        </div>

        <div class="results-section">
          <h2>Calculation Results</h2>
          
          <div class="results-grid">
            <div class="result-card">
              <h3>Year 1 Income</h3>
              <div class="result-value" id="yr1_total">$0.00</div>
            </div>
            <div class="result-card">
              <h3>Year 2 Income</h3>
              <div class="result-value" id="yr2_total">$0.00</div>
            </div>
            <div class="result-card highlight">
              <h3>Monthly Income</h3>
              <div class="result-value" id="monthly_income">$0.00</div>
            </div>
          </div>

          <div class="action-buttons">
            <button type="button" class="btn btn-primary" onclick="exportCSV()">üìÑ Export CSV</button>
            <button type="button" class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
            <button type="button" class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Clear All</button>
          </div>
        </div>

        <div class="chart-section">
          <div class="chart-header" onclick="toggleMath()">
            <h2>üìê Show Calculation Steps</h2>
            <button class="chart-toggle" id="mathToggle">Show Math</button>
          </div>
          <div class="chart-content" id="mathSection">
            <div class="math-steps">
              <div class="math-step">
                <h4>C-Corporation Income Formula</h4>
                <div class="math-formula">
                  <div class="math-values">
                    Subtotal = Cap Gain + Net Gain + Other + Dep + Depl + DPD + Amort + NOL + Taxable<br>
                    Pre-Dividend = (Subtotal ‚àí Tax ‚àí Mortgages ‚àí Meals) √ó Ownership %<br>
                    Annual Income = Pre-Dividend ‚àí Dividends Paid<br><br>
                    IF Year 2 provided AND Year 1 > Year 2:<br>
                    &nbsp;&nbsp;Monthly = (Year 1 + Year 2) / 24<br>
                    ELSE:<br>
                    &nbsp;&nbsp;Monthly = Year 1 / 12
                  </div>
                </div>
              </div>
              
              <div class="math-step">
                <h4>Year 1 Calculation</h4>
                <div class="math-formula" id="mathYear1"></div>
              </div>
              
              <div class="math-step">
                <h4>Year 2 Calculation</h4>
                <div class="math-formula" id="mathYear2"></div>
              </div>

              <div class="math-step highlight">
                <h4>Monthly Income Result</h4>
                <div class="math-formula" id="mathMonthly"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="footer">
          <div class="footer-title">Form 1120 Guidelines</div>
          <p>C-Corporation income analysis includes taxable income plus non-cash add-backs (depreciation, depletion, amortization, NOL). Corporate taxes and short-term obligations are subtracted. Dividends paid to the borrower are deducted after applying ownership percentage since they're reported as personal income.</p>
        </div>
      </div>
    </div>

    <script>
      function parseNum(id) {
        const val = parseFloat(document.getElementById(id).value);
        return isNaN(val) ? 0 : val;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);
      }

      function calculate() {
        const cap1 = parseNum('cap1'), cap2 = parseNum('cap2');
        const net1 = parseNum('net1'), net2 = parseNum('net2');
        const oth1 = parseNum('oth1'), oth2 = parseNum('oth2');
        const dep1 = parseNum('dep1'), dep2 = parseNum('dep2');
        const depl1 = parseNum('depl1'), depl2 = parseNum('depl2');
        const dpd1 = parseNum('dpd1'), dpd2 = parseNum('dpd2');
        const amort1 = parseNum('amort1'), amort2 = parseNum('amort2');
        const nol1 = parseNum('nol1'), nol2 = parseNum('nol2');
        const taxable1 = parseNum('taxable1'), taxable2 = parseNum('taxable2');
        const tax1 = parseNum('totaltax1'), tax2 = parseNum('totaltax2');
        const mort1 = parseNum('mort1'), mort2 = parseNum('mort2');
        const meals1 = parseNum('meals1'), meals2 = parseNum('meals2');
        const div1 = parseNum('dividend1'), div2 = parseNum('dividend2');
        const ownership = parseNum('ownership') / 100;

        // Show warning if ownership < 100
        document.getElementById('ownershipWarning').style.display = ownership < 1 ? 'block' : 'none';

        // Sum add-backs
        const sum1 = cap1 + net1 + oth1 + dep1 + depl1 + dpd1 + amort1 + nol1 + taxable1;
        const sum2 = cap2 + net2 + oth2 + dep2 + depl2 + dpd2 + amort2 + nol2 + taxable2;

        // Calculate totals: (sum - deductions) * ownership - dividends
        const total1 = (sum1 - tax1 - mort1 - meals1) * ownership - div1;
        const total2 = (sum2 - tax2 - mort2 - meals2) * ownership - div2;

        // Determine if year 2 has values
        const year2Vals = [cap2, net2, oth2, dep2, depl2, dpd2, amort2, nol2, taxable2, tax2, mort2, meals2, div2];
        const hasYr2 = year2Vals.some(v => v !== 0);

        let monthly, method;
        if (hasYr2 && total1 > total2) {
          monthly = (total1 + total2) / 24;
          method = 'average';
        } else {
          monthly = total1 / 12;
          method = 'recent';
        }

        document.getElementById('yr1_total').textContent = formatCurrency(total1);
        document.getElementById('yr2_total').textContent = formatCurrency(total2);
        document.getElementById('monthly_income').textContent = formatCurrency(monthly);

        updateMathSteps({ sum1, sum2, tax1, tax2, mort1, mort2, meals1, meals2, div1, div2, ownership: ownership * 100, total1, total2, monthly, method });
      }

      function updateMathSteps(d) {
        document.getElementById('mathYear1').innerHTML = `
          Subtotal: ${formatCurrency(d.sum1)}<br>
          Less Tax: ${formatCurrency(d.tax1)}<br>
          Less Mortgages: ${formatCurrency(d.mort1)}<br>
          Less Meals: ${formatCurrency(d.meals1)}<br>
          √ó Ownership: ${d.ownership}%<br>
          Less Dividends: ${formatCurrency(d.div1)}
          <div class="math-values">Year 1 = (${formatCurrency(d.sum1)} - ${formatCurrency(d.tax1)} - ${formatCurrency(d.mort1)} - ${formatCurrency(d.meals1)}) √ó ${d.ownership}% - ${formatCurrency(d.div1)} = <strong>${formatCurrency(d.total1)}</strong></div>
        `;

        document.getElementById('mathYear2').innerHTML = `
          Subtotal: ${formatCurrency(d.sum2)}<br>
          Less Tax: ${formatCurrency(d.tax2)}<br>
          Less Mortgages: ${formatCurrency(d.mort2)}<br>
          Less Meals: ${formatCurrency(d.meals2)}<br>
          √ó Ownership: ${d.ownership}%<br>
          Less Dividends: ${formatCurrency(d.div2)}
          <div class="math-values">Year 2 = <strong>${formatCurrency(d.total2)}</strong></div>
        `;

        const methodText = d.method === 'average' ? '24-month average (Year 1 > Year 2)' : 'Year 1 / 12';
        document.getElementById('mathMonthly').innerHTML = `
          Method: ${methodText}
          <div class="math-values"><strong>Monthly Income: ${formatCurrency(d.monthly)}</strong></div>
        `;
      }

      function toggleMath() {
        const section = document.getElementById('mathSection');
        const toggle = document.getElementById('mathToggle');
        section.classList.toggle('open');
        toggle.textContent = section.classList.contains('open') ? 'Hide Math' : 'Show Math';
      }

      function exportCSV() {
        const data = [
          ['Form 1120 Corporation Income Calculator'],
          [''],
          ['Year 1 Income', document.getElementById('yr1_total').textContent],
          ['Year 2 Income', document.getElementById('yr2_total').textContent],
          ['Monthly Income', document.getElementById('monthly_income').textContent],
          ['Ownership %', parseNum('ownership')],
          [''],
          ['Generated', new Date().toLocaleString()]
        ];
        const csv = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `form1120-income-${Date.now()}.csv`;
        a.click();
      }

      function clearAll() {
        document.querySelectorAll('input[type="number"]').forEach(input => {
          input.value = input.id === 'ownership' ? '100' : '0';
        });
        calculate();
      }

      document.addEventListener('DOMContentLoaded', calculate);
    </script>
  </body>
</html>
