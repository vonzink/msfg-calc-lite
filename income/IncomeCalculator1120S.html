<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form 1120S S-Corporation Income Calculator - MSFG Home Loans</title>
    <link rel="stylesheet" href="/css/main.css" />
    <style>
      .income-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; background: var(--light); border-radius: 8px; overflow: hidden; }
      .income-table th { background: var(--primary); color: var(--light); padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; }
      .income-table td { padding: 0.75rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
      .income-table tr:last-child td { border-bottom: none; }
      .income-table tr:hover td { background: var(--light-gray); }
      .income-table input[type="number"] { width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font-size: 0.9rem; background: var(--light-gray); }
      .income-table input[type="number"]:focus { outline: none; border-color: var(--accent); background: var(--light); }
      .line-number { font-weight: 600; color: var(--primary); white-space: nowrap; font-size: 0.85rem; }
      .sign-col { text-align: center; font-weight: 700; width: 50px; }
      .sign-col.add { color: var(--success); }
      .sign-col.subtract { color: var(--danger); }
      .ownership-row { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; padding: 1rem; background: var(--light-gray); border-radius: 8px; }
      .ownership-row label { font-weight: 600; color: var(--primary); }
      .ownership-row input { width: 100px; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem; text-align: center; }
      .corp-results { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem; }
      .corp-result-item { background: var(--light); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; text-align: center; }
      .corp-result-item .label { font-size: 0.85rem; color: var(--gray); margin-bottom: 0.5rem; }
      .corp-result-item .value { font-size: 1.1rem; font-weight: 700; color: var(--primary); }
      .math-steps { display: flex; flex-direction: column; gap: 1rem; }
      .math-step { background: var(--light-gray); border-radius: 8px; padding: 1.25rem; border-left: 4px solid var(--accent); }
      .math-step.highlight { background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%); border-left-color: var(--primary); }
      .math-step h4 { color: var(--primary); margin: 0 0 0.75rem 0; font-size: 1rem; }
      .math-formula { font-family: 'Courier New', monospace; font-size: 0.9rem; color: var(--dark); line-height: 1.8; }
      .math-values { display: block; margin-top: 0.5rem; padding: 0.75rem; background: var(--light); border-radius: 4px; color: var(--primary); font-weight: 600; }
      .policy-box { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
      .policy-box h5 { color: #856404; margin-bottom: 0.5rem; }
      .policy-box p { color: #856404; font-size: 0.9rem; margin: 0; }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="header">
        <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/Compass/Compass+Home+Loan+-+Color+Transparent+Background.png" alt="Compass Home Loan" class="header-logo" />
        <h1>Form 1120S S-Corporation Income Calculator</h1>
        <p>Calculate monthly income from S-Corporation (Form 1120S) returns with ownership percentages and comprehensive add-backs.</p>
      </div>
      
      <div class="content">
        
        <div class="policy-box">
          <h5>üìã S-Corporation Income Policy</h5>
          <p>S-Corp income flows through to owners via K-1. Add back non-cash expenses (depreciation, depletion, amortization), subtract short-term debt and non-deductible expenses, then apply ownership percentage.</p>
        </div>

        <!-- Corporation 1 -->
        <div class="section">
          <h2>S-Corporation 1</h2>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Line #</th>
                <th>Sign</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Net Gain or Loss (non-recurring)</td>
                <td class="line-number">4</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="c1_net1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_net2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Other Income or Loss (non-recurring)</td>
                <td class="line-number">5</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="c1_oth1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_oth2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depreciation</td>
                <td class="line-number">14</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c1_dep1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_dep2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depletion</td>
                <td class="line-number">15</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c1_depl1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_depl2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Amortization/Casualty Loss</td>
                <td class="line-number">19</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c1_amort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_amort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Mortgages/Notes Payable &lt; 1 Year</td>
                <td class="line-number">Sch L ln 17</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="c1_mort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_mort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Meals & Entertainment Exclusion</td>
                <td class="line-number">M-1 ln 3b</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="c1_meals1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c1_meals2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="ownership-row">
            <label for="c1_owner">Ownership Percentage:</label>
            <input type="number" id="c1_owner" value="100" min="0" max="100" step="0.01" oninput="calculate()" />
            <span>%</span>
          </div>
          
          <div class="corp-results">
            <div class="corp-result-item">
              <div class="label">Year 1 Income</div>
              <div class="value" id="c1_year1">$0.00</div>
            </div>
            <div class="corp-result-item">
              <div class="label">Year 2 Income</div>
              <div class="value" id="c1_year2">$0.00</div>
            </div>
            <div class="corp-result-item">
              <div class="label">Monthly Income</div>
              <div class="value" id="c1_month">$0.00</div>
            </div>
          </div>
        </div>

        <!-- Corporation 2 -->
        <div class="section">
          <h2>S-Corporation 2 (Optional)</h2>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Line #</th>
                <th>Sign</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Net Gain or Loss (non-recurring)</td>
                <td class="line-number">4</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="c2_net1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_net2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Other Income or Loss (non-recurring)</td>
                <td class="line-number">5</td>
                <td class="sign-col add">+/‚àí</td>
                <td><input type="number" id="c2_oth1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_oth2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depreciation</td>
                <td class="line-number">14</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c2_dep1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_dep2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Depletion</td>
                <td class="line-number">15</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c2_depl1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_depl2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Amortization/Casualty Loss</td>
                <td class="line-number">19</td>
                <td class="sign-col add">+</td>
                <td><input type="number" id="c2_amort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_amort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Mortgages/Notes Payable &lt; 1 Year</td>
                <td class="line-number">Sch L ln 17</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="c2_mort1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_mort2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Meals & Entertainment Exclusion</td>
                <td class="line-number">M-1 ln 3b</td>
                <td class="sign-col subtract">‚àí</td>
                <td><input type="number" id="c2_meals1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="c2_meals2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="ownership-row">
            <label for="c2_owner">Ownership Percentage:</label>
            <input type="number" id="c2_owner" value="100" min="0" max="100" step="0.01" oninput="calculate()" />
            <span>%</span>
          </div>
          
          <div class="corp-results">
            <div class="corp-result-item">
              <div class="label">Year 1 Income</div>
              <div class="value" id="c2_year1">$0.00</div>
            </div>
            <div class="corp-result-item">
              <div class="label">Year 2 Income</div>
              <div class="value" id="c2_year2">$0.00</div>
            </div>
            <div class="corp-result-item">
              <div class="label">Monthly Income</div>
              <div class="value" id="c2_month">$0.00</div>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
          <h2>Combined Results</h2>
          
          <div class="results-grid">
            <div class="result-card">
              <h3>S-Corp 1</h3>
              <div class="result-value" id="result_c1">$0.00</div>
            </div>
            <div class="result-card">
              <h3>S-Corp 2</h3>
              <div class="result-value" id="result_c2">$0.00</div>
            </div>
            <div class="result-card highlight">
              <h3>Total Monthly Income</h3>
              <div class="result-value" id="combined_s">$0.00</div>
            </div>
          </div>

          <div class="action-buttons">
            <button type="button" class="btn btn-primary" onclick="exportCSV()">üìÑ Export CSV</button>
            <button type="button" class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
            <button type="button" class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Clear All</button>
          </div>
        </div>

        <!-- Show Calculations -->
        <div class="chart-section">
          <div class="chart-header" onclick="toggleMath()">
            <h2>üìê Show Calculation Steps</h2>
            <button class="chart-toggle" id="mathToggle">Show Math</button>
          </div>
          <div class="chart-content" id="mathSection">
            <div class="math-steps">
              <div class="math-step">
                <h4>S-Corporation Income Formula</h4>
                <div class="math-formula">
                  <div class="math-values">
                    Subtotal = Net Gain + Other + Depreciation + Depletion + Amortization<br>
                    Annual = (Subtotal ‚àí Mortgages ‚àí Meals)<br><br>
                    IF Year 2 provided AND Year 1 > Year 2:<br>
                    &nbsp;&nbsp;Monthly = ((Year 1 + Year 2) / 24) √ó Ownership %<br>
                    ELSE:<br>
                    &nbsp;&nbsp;Monthly = (Year 1 / 12) √ó Ownership %
                  </div>
                </div>
              </div>
              
              <div class="math-step">
                <h4>S-Corp 1 Calculation</h4>
                <div class="math-formula" id="mathC1"></div>
              </div>
              
              <div class="math-step">
                <h4>S-Corp 2 Calculation</h4>
                <div class="math-formula" id="mathC2"></div>
              </div>

              <div class="math-step highlight">
                <h4>Total Monthly Income</h4>
                <div class="math-formula" id="mathTotal"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="footer">
          <div class="footer-title">Form 1120S Guidelines</div>
          <p>S-Corporation income passes through to shareholders via Schedule K-1. The business return (1120S) provides adjustments for non-cash expenses and business obligations. The borrower's share is determined by their ownership percentage as shown on the K-1.</p>
        </div>
      </div>
    </div>

    <script>
      function parseNum(id) {
        const val = parseFloat(document.getElementById(id).value);
        return isNaN(val) ? 0 : val;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);
      }

      function computeCorp(prefix) {
        const net1 = parseNum(prefix + '_net1'), net2 = parseNum(prefix + '_net2');
        const oth1 = parseNum(prefix + '_oth1'), oth2 = parseNum(prefix + '_oth2');
        const dep1 = parseNum(prefix + '_dep1'), dep2 = parseNum(prefix + '_dep2');
        const depl1 = parseNum(prefix + '_depl1'), depl2 = parseNum(prefix + '_depl2');
        const amort1 = parseNum(prefix + '_amort1'), amort2 = parseNum(prefix + '_amort2');
        const mort1 = parseNum(prefix + '_mort1'), mort2 = parseNum(prefix + '_mort2');
        const meals1 = parseNum(prefix + '_meals1'), meals2 = parseNum(prefix + '_meals2');
        const ownerPct = parseNum(prefix + '_owner') / 100;

        const year1 = net1 + oth1 + dep1 + depl1 + amort1 - mort1 - meals1;
        const year2 = net2 + oth2 + dep2 + depl2 + amort2 - mort2 - meals2;

        const year2Vals = [net2, oth2, dep2, depl2, amort2, mort2, meals2];
        const hasYr2 = year2Vals.some(v => v !== 0);

        let monthly, method;
        if (hasYr2 && year1 > year2) {
          monthly = ((year1 + year2) / 24) * ownerPct;
          method = 'average';
        } else {
          monthly = (year1 / 12) * ownerPct;
          method = 'recent';
        }

        return { year1, year2, monthly, method, ownerPct: ownerPct * 100, mort1, mort2, meals1, meals2 };
      }

      function calculate() {
        const c1 = computeCorp('c1');
        document.getElementById('c1_year1').textContent = formatCurrency(c1.year1);
        document.getElementById('c1_year2').textContent = formatCurrency(c1.year2);
        document.getElementById('c1_month').textContent = formatCurrency(c1.monthly);
        document.getElementById('result_c1').textContent = formatCurrency(c1.monthly);

        const c2 = computeCorp('c2');
        document.getElementById('c2_year1').textContent = formatCurrency(c2.year1);
        document.getElementById('c2_year2').textContent = formatCurrency(c2.year2);
        document.getElementById('c2_month').textContent = formatCurrency(c2.monthly);
        document.getElementById('result_c2').textContent = formatCurrency(c2.monthly);

        const combined = c1.monthly + c2.monthly;
        document.getElementById('combined_s').textContent = formatCurrency(combined);

        updateMathSteps(c1, c2, combined);
      }

      function updateMathSteps(c1, c2, combined) {
        const c1Method = c1.method === 'average' ? '24-month average' : 'Year 1 / 12';
        document.getElementById('mathC1').innerHTML = `
          Year 1 Subtotal: ${formatCurrency(c1.year1 + c1.mort1 + c1.meals1)}<br>
          Less Mortgages: ${formatCurrency(c1.mort1)}<br>
          Less Meals: ${formatCurrency(c1.meals1)}<br>
          Year 1 = ${formatCurrency(c1.year1)}<br>
          Year 2 = ${formatCurrency(c1.year2)}<br>
          Method: ${c1Method} √ó ${c1.ownerPct}%
          <div class="math-values"><strong>Monthly: ${formatCurrency(c1.monthly)}</strong></div>
        `;

        const c2Method = c2.method === 'average' ? '24-month average' : 'Year 1 / 12';
        document.getElementById('mathC2').innerHTML = `
          Year 1 = ${formatCurrency(c2.year1)}<br>
          Year 2 = ${formatCurrency(c2.year2)}<br>
          Method: ${c2Method} √ó ${c2.ownerPct}%
          <div class="math-values"><strong>Monthly: ${formatCurrency(c2.monthly)}</strong></div>
        `;

        document.getElementById('mathTotal').innerHTML = `
          S-Corp 1: ${formatCurrency(c1.monthly)}<br>
          + S-Corp 2: ${formatCurrency(c2.monthly)}<br>
          <div class="math-values"><strong>Total Monthly: ${formatCurrency(combined)}</strong></div>
        `;
      }

      function toggleMath() {
        const section = document.getElementById('mathSection');
        const toggle = document.getElementById('mathToggle');
        section.classList.toggle('open');
        toggle.textContent = section.classList.contains('open') ? 'Hide Math' : 'Show Math';
      }

      function exportCSV() {
        const c1 = computeCorp('c1');
        const c2 = computeCorp('c2');
        const combined = c1.monthly + c2.monthly;
        const data = [
          ['Form 1120S S-Corporation Income Calculator'],
          [''],
          ['Corporation', 'Year 1', 'Year 2', 'Monthly'],
          ['S-Corp 1', c1.year1, c1.year2, c1.monthly],
          ['S-Corp 2', c2.year1, c2.year2, c2.monthly],
          [''],
          ['Total Monthly Income', '', '', combined],
          ['Generated', new Date().toLocaleString()]
        ];
        const csv = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `form1120s-income-${Date.now()}.csv`;
        a.click();
      }

      function clearAll() {
        document.querySelectorAll('input[type="number"]').forEach(input => {
          input.value = input.id.includes('owner') ? '100' : '0';
        });
        calculate();
      }

      document.addEventListener('DOMContentLoaded', calculate);
    </script>
  </body>
</html>
