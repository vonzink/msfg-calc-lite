<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • Schedule F Income Calculator</title>
    <link rel="stylesheet" href="/css/main.css" />
    <style>
        body { padding: 0; }
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--light);
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo img { height: 60px; width: auto; }
        .logo h1 { margin: 0; font-size: 1.5rem; font-weight: 300; color: var(--light); }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }
        .description { text-align: center; color: var(--gray); max-width: 800px; margin: 0 auto 2rem; font-size: 1rem; line-height: 1.6; }
        .info-note {
            background: var(--light-gray);
            border-left: 4px solid var(--accent);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 6px;
        }
        .info-note p { margin: 0.5rem 0; color: var(--gray); font-size: 0.9rem; line-height: 1.5; }
        .section {
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .section h3 { color: var(--primary); margin: 0 0 1rem 0; font-size: 1.2rem; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        th {
            background: var(--primary);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 600;
        }
        td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            color: var(--dark);
            font-size: 0.9rem;
        }
        tr:hover td { background: var(--light-gray); }
        input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.15);
        }
        .sign-positive { color: var(--secondary); font-weight: 600; }
        .sign-negative { color: var(--danger, #e74c3c); font-weight: 600; }
        .sign-both { color: var(--accent); font-weight: 600; }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .result-item {
            background: var(--light-gray);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            text-align: center;
        }
        .result-item h4 {
            color: var(--gray);
            font-size: 0.85rem;
            margin: 0 0 0.5rem 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .result-item .result {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.25rem;
        }
        .actions { display: flex; gap: 1rem; margin-top: 2rem; justify-content: center; flex-wrap: wrap; }
        .btn {
            display: inline-flex; align-items: center; gap: 0.5rem;
            background: var(--primary); color: white; padding: 0.75rem 1.5rem;
            border-radius: 6px; font-weight: 500; border: none; cursor: pointer;
            font-size: 0.875rem; transition: all 0.3s ease; text-decoration: none;
        }
        .btn:hover { background: var(--secondary); transform: translateY(-1px); box-shadow: var(--shadow); }
        .btn.secondary { background: var(--accent); }
        .btn.secondary:hover { background: #27ae60; }
        .footer-note {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
            color: var(--gray);
            font-size: 0.875rem;
            line-height: 1.6;
        }
        .status-badge {
            background: rgba(46, 204, 113, 0.15);
            color: var(--secondary);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 0.5rem;
        }
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .section { padding: 1rem; }
            th, td { padding: 0.5rem; font-size: 0.8rem; }
            .actions { flex-direction: column; align-items: center; }
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="/images/msfg-logo.png" alt="MSFG Logo">
            <h1>Schedule F Income Calculator</h1>
        </div>
    </header>

    <div class="container">
        <p class="description">Calculate monthly income from Schedule F (Farm Income) tax returns. Enter farm income and expenses with proper add-backs and exclusions.</p>

        <div class="info-note">
            <p><strong>Instructions:</strong> Enter the amounts from the borrower's Schedule F (farm) tax return. Positive values should be entered without a sign and negative values with a leading minus sign. 
            The calculator sums the lines to arrive at total year income and applies the standard averaging rule. Business use of home is added back. Meal and entertainment exclusions should be entered as positive numbers — the calculator will subtract them automatically.</p>
        </div>

        <div class="section">
            <h3>Schedule F – Farm Income <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Sign</th>
                        <th>Year 1</th>
                        <th>Year 2 (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Profit or Loss</td>
                        <td class="sign-both">+/–</td>
                        <td><input type="number" id="f_np1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_np2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Ongoing Coop & CCC Payments</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="f_coop1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_coop2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (non‑recurring)</td>
                        <td class="sign-both">+/–</td>
                        <td><input type="number" id="f_other1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_other2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="f_dep1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_dep2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss/Depletion</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="f_amort1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_amort2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Business Use of Home</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="f_home1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_home2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion</td>
                        <td class="sign-negative">–</td>
                        <td><input type="number" id="f_meals1" value="0" oninput="calcF()" placeholder="0"></td>
                        <td><input type="number" id="f_meals2" value="0" oninput="calcF()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Year 1 Income</h4>
                    <span id="f_total1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Year 2 Income</h4>
                    <span id="f_total2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="f_monthly" class="result">$0.00</span>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                Clear All
            </button>
        </div>

        <div class="footer-note">
            <strong>Calculation Policy:</strong> Total year income equals the sum of income lines minus the meal & entertainment exclusion. If Year 2 values are provided and Year 1 exceeds Year 2, 
            the sum of both years is divided by 24 months; otherwise Year 1 is divided by 12. Business use of home is added back in full.
        </div>
    </div>

    <script>
        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency', currency: 'USD',
                minimumFractionDigits: 2, maximumFractionDigits: 2
            }).format(amount);
        }

        function calcF() {
            const np1 = parseNum(document.getElementById('f_np1').value);
            const np2 = parseNum(document.getElementById('f_np2').value);
            const coop1 = parseNum(document.getElementById('f_coop1').value);
            const coop2 = parseNum(document.getElementById('f_coop2').value);
            const other1 = parseNum(document.getElementById('f_other1').value);
            const other2 = parseNum(document.getElementById('f_other2').value);
            const dep1 = parseNum(document.getElementById('f_dep1').value);
            const dep2 = parseNum(document.getElementById('f_dep2').value);
            const amort1 = parseNum(document.getElementById('f_amort1').value);
            const amort2 = parseNum(document.getElementById('f_amort2').value);
            const home1 = parseNum(document.getElementById('f_home1').value);
            const home2 = parseNum(document.getElementById('f_home2').value);
            const meals1 = parseNum(document.getElementById('f_meals1').value);
            const meals2 = parseNum(document.getElementById('f_meals2').value);
            
            const total1 = np1 + coop1 + other1 + dep1 + amort1 + home1 - meals1;
            const total2 = np2 + coop2 + other2 + dep2 + amort2 + home2 - meals2;
            
            document.getElementById('f_total1').textContent = formatCurrency(total1);
            document.getElementById('f_total2').textContent = formatCurrency(total2);
            
            const hasYr2 =
                parseNum(document.getElementById('f_np2').value) !== 0 ||
                parseNum(document.getElementById('f_coop2').value) !== 0 ||
                parseNum(document.getElementById('f_other2').value) !== 0 ||
                parseNum(document.getElementById('f_dep2').value) !== 0 ||
                parseNum(document.getElementById('f_amort2').value) !== 0 ||
                parseNum(document.getElementById('f_home2').value) !== 0 ||
                parseNum(document.getElementById('f_meals2').value) !== 0;
            
            let monthly;
            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }
            
            document.getElementById('f_monthly').textContent = formatCurrency(monthly);
        }

        function exportCSV() {
            const np1 = parseNum(document.getElementById('f_np1').value);
            const np2 = parseNum(document.getElementById('f_np2').value);
            const coop1 = parseNum(document.getElementById('f_coop1').value);
            const coop2 = parseNum(document.getElementById('f_coop2').value);
            const other1 = parseNum(document.getElementById('f_other1').value);
            const other2 = parseNum(document.getElementById('f_other2').value);
            const dep1 = parseNum(document.getElementById('f_dep1').value);
            const dep2 = parseNum(document.getElementById('f_dep2').value);
            const amort1 = parseNum(document.getElementById('f_amort1').value);
            const amort2 = parseNum(document.getElementById('f_amort2').value);
            const home1 = parseNum(document.getElementById('f_home1').value);
            const home2 = parseNum(document.getElementById('f_home2').value);
            const meals1 = parseNum(document.getElementById('f_meals1').value);
            const meals2 = parseNum(document.getElementById('f_meals2').value);
            
            const total1 = np1 + coop1 + other1 + dep1 + amort1 + home1 - meals1;
            const total2 = np2 + coop2 + other2 + dep2 + amort2 + home2 - meals2;
            
            const hasYr2 =
                np2 !== 0 || coop2 !== 0 || other2 !== 0 || dep2 !== 0 ||
                amort2 !== 0 || home2 !== 0 || meals2 !== 0;
            
            let monthly;
            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }

            const data = [
                ['Schedule F Income Calculator'], [''],
                ['Farm Income Items', 'Sign', 'Year 1', 'Year 2'],
                ['Net Profit or Loss', '+/–', np1, np2],
                ['Ongoing Coop & CCC Payments', '+', coop1, coop2],
                ['Other Income or Loss (non‑recurring)', '+/–', other1, other2],
                ['Depreciation', '+', dep1, dep2],
                ['Amortization/Casualty Loss/Depletion', '+', amort1, amort2],
                ['Business Use of Home', '+', home1, home2],
                ['Meal & Entertainment Exclusion', '–', meals1, meals2],
                [''], ['Results', 'Amount'],
                ['Total Year 1 Income', total1],
                ['Total Year 2 Income', total2],
                ['Monthly Income (Policy)', monthly]
            ];

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schedule_f_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() { window.print(); }

        function clearAll() {
            document.querySelectorAll('input[type="number"]').forEach(input => { input.value = '0'; });
            calcF();
        }

        calcF();
    </script>
</body>
</html>
