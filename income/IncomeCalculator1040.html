<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form 1040 Income Calculator - MSFG Home Loans</title>
    <link rel="stylesheet" href="/css/main.css" />
    <style>
      /* Income Calculator Specific Styles */
      .income-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        background: var(--light);
        border-radius: 8px;
        overflow: hidden;
      }
      
      .income-table th {
        background: var(--primary);
        color: var(--light);
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.85rem;
      }
      
      .income-table td {
        padding: 0.75rem;
        border-bottom: 1px solid var(--border);
        vertical-align: middle;
      }
      
      .income-table tr:last-child td {
        border-bottom: none;
      }
      
      .income-table tr:hover td {
        background: var(--light-gray);
      }
      
      .income-table input[type="number"] {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 0.9rem;
        background: var(--light-gray);
      }
      
      .income-table input[type="number"]:focus {
        outline: none;
        border-color: var(--accent);
        background: var(--light);
      }
      
      .line-number {
        font-weight: 600;
        color: var(--primary);
        white-space: nowrap;
      }
      
      .sign-col {
        text-align: center;
        font-weight: 700;
        color: var(--accent);
      }
      
      .section-result {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
        border-radius: 8px;
        margin-top: 0.5rem;
      }
      
      .section-result .label {
        font-weight: 600;
        color: var(--primary);
      }
      
      .section-result .value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
      }
      
      .subsection {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--border);
      }
      
      .subsection:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      
      .subsection h4 {
        color: var(--primary);
        margin-bottom: 1rem;
        font-size: 1rem;
      }
      
      /* Math Steps */
      .math-steps {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .math-step {
        background: var(--light-gray);
        border-radius: 8px;
        padding: 1.25rem;
        border-left: 4px solid var(--accent);
      }
      
      .math-step.highlight {
        background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%);
        border-left-color: var(--primary);
      }
      
      .math-step h4 {
        color: var(--primary);
        margin: 0 0 0.75rem 0;
        font-size: 1rem;
      }
      
      .math-formula {
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        color: var(--dark);
        line-height: 1.8;
      }
      
      .math-note {
        color: var(--gray);
        font-style: italic;
        font-family: 'Segoe UI', sans-serif;
        font-size: 0.85rem;
      }
      
      .math-values {
        display: block;
        margin-top: 0.5rem;
        padding: 0.75rem;
        background: var(--light);
        border-radius: 4px;
        color: var(--primary);
        font-weight: 600;
      }
      
      .policy-box {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .policy-box h5 {
        color: #856404;
        margin-bottom: 0.5rem;
      }
      
      .policy-box p {
        color: #856404;
        font-size: 0.9rem;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="header">
        <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/Compass/Compass+Home+Loan+-+Color+Transparent+Background.png" 
             alt="Compass Home Loan" 
             class="header-logo" />
        <h1>Form 1040 Page 1 Income Calculator</h1>
        <p>
          Calculate qualifying income from W-2 wages, alimony, pensions, unemployment, and Social Security 
          using standard underwriting guidelines.
        </p>
      </div>
      
      <div class="content">
        
        <!-- Policy Explanation -->
        <div class="policy-box">
          <h5>üìã Income Averaging Policy</h5>
          <p>
            If two years are provided and the most recent year exceeds the prior year, the average of both years 
            is divided by 24 months. Otherwise, only the most recent year is divided by 12 months.
          </p>
        </div>

        <!-- W-2 Income Section -->
        <div class="section">
          <h2>W-2 Wage Income (Line 1)</h2>
          <p class="section-description">Enter W-2 wages for up to 4 employers. Use taxable wages from Box 1 of each W-2.</p>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Employer</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Employer 1</td>
                <td><input type="number" id="w2_1_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="w2_1_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Employer 2</td>
                <td><input type="number" id="w2_2_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="w2_2_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Employer 3</td>
                <td><input type="number" id="w2_3_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="w2_3_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Employer 4</td>
                <td><input type="number" id="w2_4_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="w2_4_y2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="section-result">
            <span class="label">W-2 Monthly Income:</span>
            <span class="value" id="w2_month">$0.00</span>
          </div>
        </div>

        <!-- Alimony Section -->
        <div class="section">
          <h2>Alimony Received (Line 2a)</h2>
          <p class="section-description">Alimony received under divorce agreements executed before 2019.</p>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Alimony Received</td>
                <td><input type="number" id="alimony1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="alimony2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="section-result">
            <span class="label">Alimony Monthly Income:</span>
            <span class="value" id="alimony_month">$0.00</span>
          </div>
        </div>

        <!-- Pension/Annuity Section -->
        <div class="section">
          <h2>Pension/Annuity Distributions (Lines 4a-5b)</h2>
          <p class="section-description">Enter IRA distributions and pension/annuity amounts. Use taxable amounts for qualification.</p>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Source</th>
                <th>Line</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Pension 1 - IRA Distributions</td>
                <td class="line-number">4a/4b</td>
                <td><input type="number" id="pen1_15_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen1_15_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Pension 1 - Pensions/Annuities</td>
                <td class="line-number">5a/5b</td>
                <td><input type="number" id="pen1_16_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen1_16_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Pension 2 - IRA Distributions</td>
                <td class="line-number">4a/4b</td>
                <td><input type="number" id="pen2_15_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen2_15_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Pension 2 - Pensions/Annuities</td>
                <td class="line-number">5a/5b</td>
                <td><input type="number" id="pen2_16_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen2_16_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Pension 3 - IRA Distributions</td>
                <td class="line-number">4a/4b</td>
                <td><input type="number" id="pen3_15_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen3_15_y2" value="0" oninput="calculate()" /></td>
              </tr>
              <tr>
                <td>Pension 3 - Pensions/Annuities</td>
                <td class="line-number">5a/5b</td>
                <td><input type="number" id="pen3_16_y1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="pen3_16_y2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="section-result">
            <span class="label">Pension Monthly Income:</span>
            <span class="value" id="pension_month">$0.00</span>
          </div>
        </div>

        <!-- Unemployment Section -->
        <div class="section">
          <h2>Unemployment Compensation (Line 7)</h2>
          <p class="section-description">Unemployment compensation is generally not usable for qualification unless documented as seasonal employment.</p>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Unemployment Compensation</td>
                <td><input type="number" id="unemp1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="unemp2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="section-result">
            <span class="label">Unemployment Monthly Income:</span>
            <span class="value" id="unemp_month">$0.00</span>
          </div>
        </div>

        <!-- Social Security Section -->
        <div class="section">
          <h2>Social Security Benefits (Line 6a/6b)</h2>
          <p class="section-description">Enter Social Security benefits. Use the gross amount (6a) unless tax-exempt grossing up is needed.</p>
          
          <table class="income-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Year 1 (Most Recent)</th>
                <th>Year 2 (Prior)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Social Security Benefits</td>
                <td><input type="number" id="ss1" value="0" oninput="calculate()" /></td>
                <td><input type="number" id="ss2" value="0" oninput="calculate()" /></td>
              </tr>
            </tbody>
          </table>
          
          <div class="section-result">
            <span class="label">Social Security Monthly Income:</span>
            <span class="value" id="ss_month">$0.00</span>
          </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
          <h2>Combined Results</h2>
          
          <div class="results-grid">
            <div class="result-card">
              <h3>W-2 Income</h3>
              <div class="result-value" id="result_w2">$0.00</div>
            </div>
            <div class="result-card">
              <h3>Alimony</h3>
              <div class="result-value" id="result_alimony">$0.00</div>
            </div>
            <div class="result-card">
              <h3>Pension</h3>
              <div class="result-value" id="result_pension">$0.00</div>
            </div>
            <div class="result-card">
              <h3>Unemployment</h3>
              <div class="result-value" id="result_unemp">$0.00</div>
            </div>
            <div class="result-card">
              <h3>Social Security</h3>
              <div class="result-value" id="result_ss">$0.00</div>
            </div>
            <div class="result-card highlight">
              <h3>Total Monthly Income</h3>
              <div class="result-value" id="combined1040">$0.00</div>
            </div>
          </div>

          <div class="action-buttons">
            <button type="button" class="btn btn-primary" onclick="exportCSV()">
              üìÑ Export CSV
            </button>
            <button type="button" class="btn btn-secondary" onclick="window.print()">
              üñ®Ô∏è Print
            </button>
            <button type="button" class="btn btn-secondary" onclick="clearAll()">
              üóëÔ∏è Clear All
            </button>
          </div>
        </div>

        <!-- Show Calculations Section -->
        <div class="chart-section">
          <div class="chart-header" onclick="toggleMath()">
            <h2>üìê Show Calculation Steps</h2>
            <button class="chart-toggle" id="mathToggle">Show Math</button>
          </div>
          <div class="chart-content" id="mathSection">
            <div class="math-steps">
              <div class="math-step">
                <h4>Income Averaging Policy</h4>
                <div class="math-formula">
                  <span class="math-note">Standard underwriting guidelines for income calculation:</span>
                  <div class="math-values">
                    IF Year 2 is provided AND Year 1 > Year 2:<br>
                    &nbsp;&nbsp;Monthly = (Year 1 + Year 2) / 24<br><br>
                    ELSE:<br>
                    &nbsp;&nbsp;Monthly = Year 1 / 12
                  </div>
                </div>
              </div>
              
              <div class="math-step">
                <h4>W-2 Income Calculation</h4>
                <div class="math-formula" id="mathW2">
                  <!-- Populated by JS -->
                </div>
              </div>
              
              <div class="math-step">
                <h4>Pension/Retirement Calculation</h4>
                <div class="math-formula" id="mathPension">
                  <!-- Populated by JS -->
                </div>
              </div>
              
              <div class="math-step">
                <h4>Social Security Calculation</h4>
                <div class="math-formula" id="mathSS">
                  <!-- Populated by JS -->
                </div>
              </div>

              <div class="math-step highlight">
                <h4>Total Monthly Income</h4>
                <div class="math-formula" id="mathTotal">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="footer">
          <div class="footer-title">Form 1040 Income Guidelines</div>
          <p>
            This calculator covers Page 1 income sources: W-2 wages, alimony (pre-2019 agreements), 
            IRA/pension distributions, unemployment compensation, and Social Security benefits. 
            Self-employment income, rental income, and business income require separate analysis 
            using Schedule C, E, or business tax returns.
          </p>
        </div>

      </div>
    </div>

    <script>
      // =====================================================
      // UTILITY FUNCTIONS
      // =====================================================
      
      function parseNum(id) {
        const val = parseFloat(document.getElementById(id).value);
        return isNaN(val) ? 0 : val;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        }).format(amount);
      }

      // =====================================================
      // POLICY CALCULATION
      // =====================================================
      
      function policyCalc(year1, year2) {
        const hasYr2 = year2 !== 0;
        if (hasYr2 && year1 > year2) {
          return {
            monthly: (year1 + year2) / 24,
            method: 'average',
            formula: `(${formatCurrency(year1)} + ${formatCurrency(year2)}) / 24 = ${formatCurrency((year1 + year2) / 24)}`
          };
        }
        return {
          monthly: year1 / 12,
          method: 'recent',
          formula: `${formatCurrency(year1)} / 12 = ${formatCurrency(year1 / 12)}`
        };
      }

      // =====================================================
      // MAIN CALCULATION
      // =====================================================
      
      function calculate() {
        // W-2 section
        const w2_y1 = parseNum('w2_1_y1') + parseNum('w2_2_y1') + parseNum('w2_3_y1') + parseNum('w2_4_y1');
        const w2_y2 = parseNum('w2_1_y2') + parseNum('w2_2_y2') + parseNum('w2_3_y2') + parseNum('w2_4_y2');
        const w2_result = policyCalc(w2_y1, w2_y2);
        document.getElementById('w2_month').textContent = formatCurrency(w2_result.monthly);
        document.getElementById('result_w2').textContent = formatCurrency(w2_result.monthly);

        // Alimony
        const al_y1 = parseNum('alimony1');
        const al_y2 = parseNum('alimony2');
        const al_result = policyCalc(al_y1, al_y2);
        document.getElementById('alimony_month').textContent = formatCurrency(al_result.monthly);
        document.getElementById('result_alimony').textContent = formatCurrency(al_result.monthly);

        // Pension/annuity
        const pen_y1 = parseNum('pen1_15_y1') + parseNum('pen1_16_y1') + 
                       parseNum('pen2_15_y1') + parseNum('pen2_16_y1') + 
                       parseNum('pen3_15_y1') + parseNum('pen3_16_y1');
        const pen_y2 = parseNum('pen1_15_y2') + parseNum('pen1_16_y2') + 
                       parseNum('pen2_15_y2') + parseNum('pen2_16_y2') + 
                       parseNum('pen3_15_y2') + parseNum('pen3_16_y2');
        const pen_result = policyCalc(pen_y1, pen_y2);
        document.getElementById('pension_month').textContent = formatCurrency(pen_result.monthly);
        document.getElementById('result_pension').textContent = formatCurrency(pen_result.monthly);

        // Unemployment
        const un_y1 = parseNum('unemp1');
        const un_y2 = parseNum('unemp2');
        const un_result = policyCalc(un_y1, un_y2);
        document.getElementById('unemp_month').textContent = formatCurrency(un_result.monthly);
        document.getElementById('result_unemp').textContent = formatCurrency(un_result.monthly);

        // Social Security
        const ss_y1 = parseNum('ss1');
        const ss_y2 = parseNum('ss2');
        const ss_result = policyCalc(ss_y1, ss_y2);
        document.getElementById('ss_month').textContent = formatCurrency(ss_result.monthly);
        document.getElementById('result_ss').textContent = formatCurrency(ss_result.monthly);

        // Combined
        const combined = w2_result.monthly + al_result.monthly + pen_result.monthly + 
                        un_result.monthly + ss_result.monthly;
        document.getElementById('combined1040').textContent = formatCurrency(combined);

        // Update math steps
        updateMathSteps({
          w2: { y1: w2_y1, y2: w2_y2, result: w2_result },
          pension: { y1: pen_y1, y2: pen_y2, result: pen_result },
          ss: { y1: ss_y1, y2: ss_y2, result: ss_result },
          combined: combined
        });
      }

      // =====================================================
      // MATH STEPS
      // =====================================================
      
      function updateMathSteps(data) {
        // W-2
        const w2Method = data.w2.result.method === 'average' ? 
          '(Year 1 > Year 2, using 24-month average)' : '(Using most recent year / 12)';
        document.getElementById('mathW2').innerHTML = `
          Year 1 Total: ${formatCurrency(data.w2.y1)}<br>
          Year 2 Total: ${formatCurrency(data.w2.y2)}<br>
          <span class="math-note">${w2Method}</span>
          <div class="math-values">${data.w2.result.formula}</div>
        `;

        // Pension
        const penMethod = data.pension.result.method === 'average' ? 
          '(Year 1 > Year 2, using 24-month average)' : '(Using most recent year / 12)';
        document.getElementById('mathPension').innerHTML = `
          Year 1 Total: ${formatCurrency(data.pension.y1)}<br>
          Year 2 Total: ${formatCurrency(data.pension.y2)}<br>
          <span class="math-note">${penMethod}</span>
          <div class="math-values">${data.pension.result.formula}</div>
        `;

        // Social Security
        const ssMethod = data.ss.result.method === 'average' ? 
          '(Year 1 > Year 2, using 24-month average)' : '(Using most recent year / 12)';
        document.getElementById('mathSS').innerHTML = `
          Year 1 Total: ${formatCurrency(data.ss.y1)}<br>
          Year 2 Total: ${formatCurrency(data.ss.y2)}<br>
          <span class="math-note">${ssMethod}</span>
          <div class="math-values">${data.ss.result.formula}</div>
        `;

        // Total
        document.getElementById('mathTotal').innerHTML = `
          W-2: ${formatCurrency(data.w2.result.monthly)}<br>
          + Pension: ${formatCurrency(data.pension.result.monthly)}<br>
          + Social Security: ${formatCurrency(data.ss.result.monthly)}<br>
          <div class="math-values"><strong>Total Monthly: ${formatCurrency(data.combined)}</strong></div>
        `;
      }

      function toggleMath() {
        const section = document.getElementById('mathSection');
        const toggle = document.getElementById('mathToggle');
        
        if (section.classList.contains('open')) {
          section.classList.remove('open');
          toggle.textContent = 'Show Math';
        } else {
          section.classList.add('open');
          toggle.textContent = 'Hide Math';
        }
      }

      // =====================================================
      // EXPORT & ACTIONS
      // =====================================================
      
      function exportCSV() {
        const data = [
          ['Form 1040 Page 1 Income Calculator'],
          [''],
          ['Section', 'Year 1', 'Year 2', 'Monthly Income'],
          ['W-2 Income', 
            parseNum('w2_1_y1') + parseNum('w2_2_y1') + parseNum('w2_3_y1') + parseNum('w2_4_y1'),
            parseNum('w2_1_y2') + parseNum('w2_2_y2') + parseNum('w2_3_y2') + parseNum('w2_4_y2'),
            document.getElementById('w2_month').textContent
          ],
          ['Alimony Received', 
            parseNum('alimony1'),
            parseNum('alimony2'),
            document.getElementById('alimony_month').textContent
          ],
          ['Pension/Annuity', 
            parseNum('pen1_15_y1') + parseNum('pen1_16_y1') + parseNum('pen2_15_y1') + parseNum('pen2_16_y1') + parseNum('pen3_15_y1') + parseNum('pen3_16_y1'),
            parseNum('pen1_15_y2') + parseNum('pen1_16_y2') + parseNum('pen2_15_y2') + parseNum('pen2_16_y2') + parseNum('pen3_15_y2') + parseNum('pen3_16_y2'),
            document.getElementById('pension_month').textContent
          ],
          ['Unemployment', 
            parseNum('unemp1'),
            parseNum('unemp2'),
            document.getElementById('unemp_month').textContent
          ],
          ['Social Security', 
            parseNum('ss1'),
            parseNum('ss2'),
            document.getElementById('ss_month').textContent
          ],
          [''],
          ['Total Monthly Income', '', '', document.getElementById('combined1040').textContent],
          [''],
          ['Generated', new Date().toLocaleString()]
        ];

        const csv = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `form1040-income-${Date.now()}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      }

      function clearAll() {
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => input.value = '0');
        calculate();
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', calculate);
    </script>
  </body>
</html>
